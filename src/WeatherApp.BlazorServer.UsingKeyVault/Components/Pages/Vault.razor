@page "/vault"
@rendermode InteractiveServer
@inject ISecretService SecretSvc

<PageTitle>Vault Info</PageTitle>

<h1>Get Key Vault Info</h1>

<div class="mb-3">
    <label for="secretName" class="form-label">Secret Name:</label>
    <input type="text" class="form-control" id="secretName" @bind="secretName" placeholder="Enter secret name (e.g., SqlConnectionString)" />
</div>

<button class="btn btn-primary" @onclick="GetKeVaultInfoAsync">Get Secret</button>

@if (!string.IsNullOrEmpty(connString))
{
    <div class="mt-3">
        <p><strong>Result:</strong></p>
        <div class="alert @(connString.StartsWith("Error:") ? "alert-danger" : "alert-success")" role="alert">
            <pre style="white-space: pre-wrap; word-wrap: break-word;">@connString</pre>
        </div>
    </div>
}

@if (!string.IsNullOrEmpty(errorDetails))
{
    <div class="mt-3">
        <p><strong>Error Details:</strong></p>
        <div class="alert alert-danger" role="alert">
            <pre style="white-space: pre-wrap; word-wrap: break-word; font-size: 0.9em;">@errorDetails</pre>
        </div>
    </div>
}

@code {
    private string connString = "";
    private string errorDetails = "";
    private string secretName = "SqlConnectionString";

    public async Task GetKeVaultInfoAsync()
    {
        connString = "";
        errorDetails = "";
        
        try
        {
            if (string.IsNullOrWhiteSpace(secretName))
            {
                connString = "Error: Please enter a secret name";
                return;
            }

            // Call the service to get the secret value
            var result = await SecretSvc.GetSecretValueAsync(secretName);
            connString = result ?? "Secret not found (returned null)";
        }
        catch (Exception ex)
        {
            // Handle any exceptions that may occur
            connString = $"Error: {ex.Message}";
            errorDetails = $"Exception Type: {ex.GetType().Name}\n\n" +
                          $"Message: {ex.Message}\n\n" +
                          $"StackTrace:\n{ex.StackTrace}";
            
            if (ex.InnerException != null)
            {
                errorDetails += $"\n\nInner Exception:\n" +
                               $"Type: {ex.InnerException.GetType().Name}\n" +
                               $"Message: {ex.InnerException.Message}\n" +
                               $"StackTrace:\n{ex.InnerException.StackTrace}";
            }
        }
    }
}
